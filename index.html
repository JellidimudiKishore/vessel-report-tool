<!DOCTYPE html>
<html>
<head>
  <title>Bulk Cargo Discharge Summary</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: auto;
      padding: 20px;
    }
    pre {
      background: #f4f4f4;
      padding: 15px;
      border-radius: 8px;
    }
    button {
      margin-right: 10px;
    }
    #whatsappShare button {
      background-color: #25D366;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h3>Bulk Cargo Discharge Summary</h3>
  <label>Vessel Name: <input type="text" id="vesselName"></label><br><br>
  <label>Cargo Type: <input type="text" id="cargoType"></label><br><br>
  <label>Total Bulk Quantity (MT): <input type="number" id="quantity"></label><br><br>
  <label>Work Commenced at Berth: <input type="datetime-local" id="startTime"></label><br><br>
  <label>Work Completed at Berth: <input type="datetime-local" id="endTime"></label><br><br>
  <label>Number of GSU's Used: <input type="number" id="gsuCount"></label><br><br>
  <label>Number of Loaders Used: <input type="number" id="loaderCount"></label><br><br>

  <!-- Buttons -->
  <button onclick="generateReport()">Generate Report</button>
  <a id="whatsappShare" target="_blank" style="display:none;">
    <button>Share on WhatsApp</button>
  </a>

  <pre id="output" style="margin-top:20px;"></pre>

  <script>
    let report = "";

    function generateReport() {
      const vessel = document.getElementById('vesselName').value;
      const cargo = document.getElementById('cargoType').value;
      const quantity = parseFloat(document.getElementById('quantity').value);
      const start = new Date(document.getElementById('startTime').value);
      const end = new Date(document.getElementById('endTime').value);
      const gsu = document.getElementById('gsuCount').value;
      const loaders = document.getElementById('loaderCount').value;

      if (!vessel || !cargo || isNaN(quantity) || isNaN(start.getTime()) || isNaN(end.getTime()) || end <= start) {
        document.getElementById('output').textContent = "⚠️ Please fill all fields correctly and ensure end time is after start time.";
        return;
      }

      const totalMs = end - start;
      const totalHours = totalMs / (1000 * 60 * 60);
      const totalDays = totalHours / 24;

      const dischargeRate = quantity / totalHours;
      const grossProductivity = dischargeRate * 24;

      const hours = Math.floor(totalHours);
      const minutes = Math.round((totalHours - hours) * 60);

      const formattedStart = start.toLocaleString();
      const formattedEnd = end.toLocaleString();

      report = 
`MV ${vessel} (${cargo}: ${quantity.toLocaleString()} MT)
Vsl Comm: ${formattedStart}
Vsl Comp: ${formattedEnd}
Dish rate: ${dischargeRate.toFixed(2)} Mt/hr
Gross operation time in days: ${totalDays.toFixed(2)} days
Gross operation time in hrs: ${hours} hrs ${minutes} min
Gross productivity: ${grossProductivity.toFixed(2)} Mt/day
Number of GSU: ${gsu}
Number of loaders: ${loaders}`;

      document.getElementById('output').textContent = report;

      // Show WhatsApp button with link
      const whatsappLink = "https://wa.me/?text=" + encodeURIComponent(report);
      const whatsappBtn = document.getElementById('whatsappShare');
      whatsappBtn.href = whatsappLink;
      whatsappBtn.style.display = "inline-block";
    }
  </script>
</body>
</html>
